<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Private Space</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
margin:0;
font-family:sans-serif;
background:linear-gradient(135deg,#fcd5ce,#f8edeb);
display:flex;
justify-content:center;
align-items:center;
height:100vh;
overflow:hidden;
}
.card{
width:95%;
max-width:400px;
background:white;
padding:25px;
border-radius:15px;
box-shadow:0 10px 25px rgba(0,0,0,.15);
text-align:center;
}
input,textarea{
width:100%;
padding:10px;
margin:10px 0;
border-radius:8px;
border:1px solid #ddd;
}
button{
padding:8px 15px;
border:none;
border-radius:8px;
background:#d6336c;
color:white;
cursor:pointer;
}
.hidden{display:none;}

.fadeIn{
animation:fadeIn 0.8s ease forwards;
}
@keyframes fadeIn{
from{opacity:0;transform:translateY(20px);}
to{opacity:1;transform:translateY(0);}
}
</style>
</head>
<body>

<div class="card fadeIn" id="loginBox">
<h3>Enter Password</h3>
<input type="password" id="userPass">
<button onclick="login()">Login</button>
</div>

<div class="card hidden fadeIn" id="mainBox">
<h3>Your Private Content</h3>
<textarea id="contentArea"></textarea>
<button onclick="saveContent()">Save</button>
<button onclick="openAdmin()">Admin</button>
</div>

<div class="card hidden fadeIn" id="adminBox">
<h3>Admin Panel</h3>
<input type="password" id="adminKey" placeholder="Admin Key">
<button onclick="verifyAdmin()">Verify</button>

<div id="adminArea" class="hidden">
<h4>Change Password</h4>
<input type="password" id="newPass">
<button onclick="updatePassword()">Update</button>
</div>
</div>

<script>
const supabase = window.supabase.createClient(
"https://lmbacscoddqlasdesdrn.supabase.co",
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImxtYmFjc2NvZGRxbGFzZGVzZHJuIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEwMTE4ODcsImV4cCI6MjA4NjU4Nzg4N30.s1g59A9sk7PtOxeXm6VygtYMEeIqU9YUZjDL4NHjIj0"
);

async function login(){
const entered=document.getElementById("userPass").value;

let { data } = await supabase
.from("config")
.select("password")
.eq("id",1)
.single();

if(entered===data.password){

document.getElementById("loginBox").classList.add("hidden");
document.getElementById("mainBox").classList.remove("hidden");

let deviceId = localStorage.getItem("deviceId") || crypto.randomUUID();
localStorage.setItem("deviceId", deviceId);

await supabase.from("sessions").insert([{device_id:deviceId}]);

loadContent();

}else{
alert("Wrong password");
}
}

async function loadContent(){
let { data } = await supabase
.from("content")
.select("body")
.eq("id",1)
.single();

document.getElementById("contentArea").value=data.body;
}

async function saveContent(){
const newContent=document.getElementById("contentArea").value;

await supabase
.from("content")
.update({body:newContent})
.eq("id",1);

alert("Content updated globally");
}

function openAdmin(){
document.getElementById("adminBox").classList.remove("hidden");
}

async function verifyAdmin(){
const key=document.getElementById("adminKey").value;

let { data } = await supabase
.from("admin")
.select("key")
.eq("id",1)
.single();

if(key===data.key){
document.getElementById("adminArea").classList.remove("hidden");
}else{
alert("Wrong admin key");
}
}

async function updatePassword(){
const newPass=document.getElementById("newPass").value;

await supabase
.from("config")
.update({password:newPass})
.eq("id",1);

alert("Password updated globally");
}
</script>

</body>
</html>